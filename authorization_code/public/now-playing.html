<!doctype html>
<html>

<head>
    <title>spotify-share-for-drive</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
    <style type="text/css">
        .text-overflow {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 500px;
        }
        
        #nav {
            list-style: none;
            display: flex;
            justify-content: center;
            padding: 0px;
        }
        
        #nav li {
            width: 140px;
            text-align: center;
            background-color: #333;
            height: 50px;
            line-height: 50px;
            margin-right: 2px;
        }
        
        #nav li a {
            text-decoration: none;
            color: #fff;
            font-weight: bold;
            padding: 20px;
        }
        
        body {
            text-align: center;
        }
        
        #now-playing-track {
            margin: 20px auto;
            max-width: 750px;
            text-align: left;
        }
        
        .card-container {
            display: flex;
            height: 300;
        }
        
        .card-img img {
            width: 200px;
            height: 200px;
        }
        
        .card-text {
            width: 100%;
            margin: 20px 20px 20px 30px;
        }
        
        .resume-and-pause {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }
        
        #resume,
        #pause {
            display: none;
        }
        
        .video_play {
            display: inline-block;
            position: relative;
            width: 1em;
            height: 1em;
            border: 0.05em solid currentColor;
            border-radius: 50%;
            color: #000;
            font-size: 100px;
            margin-right: 10px;
        }
        
        .video_play::before {
            position: absolute;
            top: 50%;
            left: 30%;
            transform: translateY(-50%);
            width: 0px;
            height: 0px;
            border: 0.3em solid transparent;
            border-left: 0.5em solid currentColor;
            box-sizing: border-box;
            content: "";
        }
        
        .video_play:hover {
            cursor: pointer;
            opacity: .7;
        }
        
        .video_pause {
            display: inline-block;
            position: relative;
            width: 1em;
            height: 1em;
            border: 0.05em solid currentColor;
            border-radius: 50%;
            color: #000;
            font-size: 100px;
            margin-right: 10px;
        }
        
        .video_pause::before,
        .video_pause::after {
            position: absolute;
            top: 50%;
            transform: translateX(-50%) translateY(-50%);
            width: 0.1em;
            height: 0.5em;
            box-sizing: border-box;
            background-color: currentColor;
            content: "";
        }
        
        .video_pause::before {
            left: 40%;
        }
        
        .video_pause::after {
            left: 60%;
        }
        
        .video_pause:hover {
            cursor: pointer;
            opacity: .7;
        }
        
        .skip-next {
            display: inline-block;
            position: relative;
            width: 1em;
            height: 1em;
            color: #000;
            font-size: 100px;
        }
        
        .skip-next::before {
            position: absolute;
            top: 50%;
            left: 30%;
            transform: translateY(-50%);
            width: 0px;
            height: 0px;
            border: 0.3em solid transparent;
            border-left: 0.5em solid currentColor;
            box-sizing: border-box;
            content: "";
        }
        
        .skip-next::after {
            position: absolute;
            top: 50%;
            transform: translateX(-50%) translateY(-50%);
            width: 0.1em;
            height: 0.6em;
            box-sizing: border-box;
            background-color: currentColor;
            content: "";
            left: 80%;
        }
        
        .skip-next:hover {
            cursor: pointer;
            opacity: .7;
        }
        
        .skip-pre {
            display: inline-block;
            position: relative;
            width: 1em;
            height: 1em;
            color: #000;
            font-size: 100px;
            margin-right: 10px;
        }
        
        .skip-pre::before {
            position: absolute;
            top: 50%;
            right: 30%;
            transform: translateY(-50%);
            width: 0px;
            height: 0px;
            border: 0.3em solid transparent;
            border-right: 0.5em solid currentColor;
            box-sizing: border-box;
            content: "";
        }
        
        .skip-pre::after {
            position: absolute;
            top: 50%;
            transform: translateX(-50%) translateY(-50%);
            width: 0.1em;
            height: 0.6em;
            box-sizing: border-box;
            background-color: currentColor;
            content: "";
            left: 20%;
        }
        
        .skip-pre:hover {
            cursor: pointer;
            opacity: .7;
        }
        
        #skip-pre,
        #skip-next {
            display: none;
        }
    </style>
</head>

<body>
    <header id="header">
        <ul id="nav">
            <li><a href="/home">Home</a></li>
            <li><a href="/now_playing">Now</a></li>
            <li><a href="#">Add</a></li>
            <li><a href="#">Search</a></li>
        </ul>
    </header>

    <div class="container">
        <div id="loggedin">
            <h1>Currently playing track</h1>
            <div id="now-playing-track" class="card-container">
                <div class="card-img" id="song-img">
                </div>
                <div class="card-text" id="song-info">
                    <div class="card-img" id="song-name">
                    </div>
                    <div class="card-img" id="artists-name">
                    </div>
                </div>
            </div>

            <div class="resume-and-pause">
                <div id="skip-pre">
                    <div class="skip-pre" id="skip-pre-btn"></div>
                </div>
                <div id="resume">
                    <div class="video_play" id="resume-btn"></div>
                </div>
                <div id="pause">
                    <div class="video_pause" id="pause-btn"></div>
                </div>
                <div id="skip-next">
                    <div class="skip-next" id="skip-next-btn"></div>
                </div>
            </div>
        </div>
    </div>

    <script language="javascript" type="text/javascript">
        const resume_btn = document.getElementById('resume-btn');
        const pause_btn = document.getElementById('pause-btn');
        const skip_next_btn = document.getElementById('skip-next-btn');
        const skip_pre_btn = document.getElementById('skip-pre-btn');

        pause_btn.addEventListener('click', () => {
            $.ajax({
                    type: "GET",
                    url: "/pause_playback",
                })
                .done(function(data) {
                    update();
                })
                .fail(function(XMLHttpRequest, textStatus, errorThrown) {
                    alert('fali to read \'pause_playback\'');
                });
        });

        resume_btn.addEventListener('click', () => {
            $.ajax({
                    type: "GET",
                    url: "/start_playback",
                })
                .done(function(data) {
                    update();
                })
                .fail(function(XMLHttpRequest, textStatus, errorThrown) {
                    alert('fali to read \'start_playback\'');
                });
        });

        skip_next_btn.addEventListener('click', () => {
            $.ajax({
                    type: "GET",
                    url: "/next_track",
                })
                .done(function(data) {
                    update();
                })
                .fail(function(XMLHttpRequest, textStatus, errorThrown) {
                    alert('fali to read \'next_track\'');
                });
        });

        skip_pre_btn.addEventListener('click', () => {
            $.ajax({
                    type: "GET",
                    url: "/previous_track",
                })
                .done(function(data) {
                    update();
                })
                .fail(function(XMLHttpRequest, textStatus, errorThrown) {
                    alert('fali to read \'previous_track\'');
                });
        });
    </script>

    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script>
        function escapeHTML(string) {
            return string.replace(/&/g, '&lt;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, "&#x27;");
        }

        function update() {
            $.ajax({
                    type: "GET",
                    url: "/currently_playing",
                    // dataType: "json"
                })
                .done(function(data) {
                    if (data == 'No track currently playing.') {
                        target = document.getElementById("now-playing-track");
                        target.innerHTML = data;
                        $('#resume').hide();
                        $('#pause').hide();
                        $('#skip-next').hide();
                        $('#skip-pre').hide();
                    } else {
                        var song_name = escapeHTML(data['item']['name']);
                        var artists_name = escapeHTML(data['item']['artists'][0]['name']);
                        var song_image_uri = escapeHTML(data['item']['album']['images'][1]["url"]);
                        var is_playing = data['is_playing'];

                        target = document.getElementById("song-img");
                        target.innerHTML = "<a href=\"#\"><img \" src=\"" +
                            song_image_uri +
                            "\" alt=\"image of album\" /></a>";
                        target = document.getElementById("song-name");
                        target.innerHTML = "<h2>Title :   " + song_name + "</h2>";
                        target = document.getElementById("artists-name");
                        target.innerHTML = "<h2>Artist : " + artists_name + "</h2>";

                        if (is_playing) {
                            $('#resume').hide();
                            $('#pause').show();
                        } else {
                            $('#resume').show();
                            $('#pause').hide();
                        }

                        $('#skip-next').show();
                        $('#skip-pre').show();
                    }
                })
                .fail(function(XMLHttpRequest, textStatus, errorThrown) {
                    alert('fali to read \'currently_playing\'');
                });
        }

        update();
        setInterval(update, 10000);
    </script>

</body>

</html>